{
	# Global options
	email mateo@lucai.bio

	# Use staging for testing, comment out for production
	# acme_ca https://acme-staging-v02.api.letsencrypt.org/directory

	# ========== LOGGING INTENSO PARA DEBUG ==========
	# Nivel DEBUG captura TODO: ACME, errores, descubrimiento Docker, etc.
	log {
		output file /var/log/caddy/caddy-debug.log {
			roll_size 100mb
			roll_keep 10
			roll_keep_for 720h  # 30 días
		}
		format json
		level DEBUG  # Cambiar a INFO en producción
	}

	# Enable Docker provider for automatic service discovery
	# Services are discovered via Docker labels (caddy.*)

	# Configuración adicional para logs detallados de ACME
	# Los logs de ACME/certificados aparecen en caddy-debug.log con level DEBUG
}

# Admin/debug endpoint with Basic Auth (static configuration)
# This is defined here since it's not a Docker service
caddy.infra.cluster.qb.fcen.uba.ar {
	# Simple health/status endpoint
	respond /health "OK - Caddy is running" 200

	# Root path shows basic info
	respond / "Caddy Admin - nodo0 (Auto-discovery enabled)" 200

	# Logging específico del admin endpoint
	log {
		output file /var/log/caddy/admin.log {
			roll_size 10mb
			roll_keep 3
		}
		format json
		level DEBUG
	}
}

# All other services are discovered automatically via Docker labels
# No need to define routes here - just add labels to your containers!
#
# Example labels for a service:
#   caddy: "genphenia.infra.cluster.qb.fcen.uba.ar"
#   caddy.reverse_proxy: "{{upstreams 8080}}"
#   caddy.tls.dns: "cloudflare"  # optional
