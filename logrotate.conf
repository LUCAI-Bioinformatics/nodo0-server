# Logrotate configuration for Caddy logs
# Install: sudo cp logrotate.conf /etc/logrotate.d/caddy-nodo0
# Test: sudo logrotate -d /etc/logrotate.d/caddy-nodo0

/home/mate/qb-65/traefik-gateway-nodo0/nodo0-server/logs/*.log {
    # Rotar diariamente
    daily

    # Mantener 30 días de logs
    rotate 30

    # Comprimir logs viejos
    compress
    delaycompress

    # No fallar si el log no existe
    missingok

    # No rotar si está vacío
    notifempty

    # Crear nuevo log con estos permisos
    create 0644 mate mate

    # Compartir scripts entre todos los logs
    sharedscripts

    # Después de rotar, no hacer nada (Caddy maneja rotación interna)
    # pero liberar el file handle
    postrotate
        # Signal Caddy to reopen log files (optional)
        # docker exec caddy_nodo0 caddy reload --config /etc/caddy/Caddyfile 2>/dev/null || true
    endscript
}
